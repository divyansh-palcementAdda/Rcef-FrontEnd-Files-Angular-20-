<h1 class="text-center my-4 fw-bold" style="color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
  Task Requests
</h1>

<div class="container my-5">
  <div class="card shadow-lg animate__animated animate__fadeIn border-0">

    <!-- Premium Gradient Header -->
    <div class="card-header py-4 text-white text-center rounded-top"
         style="background: linear-gradient(135deg, #2b7818 0%, #34D399 50%, #1e3a8a 100%);">
      <h3 class="mb-1 fw-bold">Task Requests Management</h3>
      <small class="opacity-90">
        {{ currentRole === 'ADMIN' ? 'All Requests in System' :
           currentRole === 'HOD' ? 'Requests from Your Department(s)' :
           'Your Submitted Requests' }}
      </small>
    </div>

    <div class="card-body p-4">

      <!-- Error Alert -->
      <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <strong>Error!</strong> {{ errorMessage }}
        <button type="button" class="btn-close" (click)="errorMessage = null"></button>
      </div>

      <!-- Loading Spinner -->
      <div *ngIf="loading" class="text-center my-5 py-5">
        <div class="spinner-border text-primary" style="width: 4rem; height: 4rem;" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-4 fs-5 text-muted">Loading requests...</p>
      </div>

      <!-- Filters Row -->
      <div class="row mb-4 g-3 align-items-end" *ngIf="!loading">
        <div class="col-lg-5 col-md-12">
          <input
            type="text"
            class="form-control form-control-lg"
            placeholder="Search by task title, user, or remarks..."
            [(ngModel)]="filters.search"
            (input)="applyFilters()">
        </div>

        <div class="col-lg-2 col-md-4">
          <select class="form-select" [(ngModel)]="filters.type" (change)="applyFilters()">
            <option value="ALL">All Types</option>
            <option value="EXTENSION">Extension</option>
            <option value="CLOSURE">Closure</option>
          </select>
        </div>

        <div class="col-lg-3 col-md-4">
          <div class="d-flex gap-2">
            <button class="btn btn-outline-danger flex-fill" (click)="resetFilters()">
              <i class="bi bi-arrow-clockwise"></i> Reset
            </button>
          </div>
        </div>
      </div>

      <!-- Desktop Table -->
      <div class="table-responsive d-none d-md-block" *ngIf="!loading">
        <table class="table table-hover align-middle table-bordered border-light">
          <thead class="table-success text-dark">
            <tr>
              <th scope="col">Task</th>
              <th scope="col">Requested By</th>
              <th scope="col">Type</th>
              <th scope="col">Status</th>
              <th scope="col">Requested On</th>
              <th scope="col">Remarks</th>
              <th scope="col" class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let req of paginatedRequests"
              class="clickable-row table-row-hover"
              (click)="navigateToTask(req.taskId)">
              <td><strong>{{ req.taskTitle }}</strong></td>
              <td>{{ req.requestedByName }}</td>
              <td>
                <span class="badge bg-info text-dark px-3 py-2">
                  <i [class]="getTypeBadge(req.requestType).icon" class="me-1"></i>
                  {{ getTypeBadge(req.requestType).text }}
                </span>
              </td>
              <td>
                <span class="badge rounded-pill fw-bold px-3 py-2" [ngClass]="getStatusClass(req.status)">
                  {{ req.status }}
                </span>
              </td>
              <td>{{ req.requestDate | date:'mediumDate' }}</td>
              <td class="text-muted small text-truncate" style="max-width: 200px;">
                {{ req.remarks || '—' }}
              </td>
              <td class="text-center">
                <button
                  class="btn btn-sm btn-outline-primary"
                  (click)="$event.stopPropagation(); navigateToTask(req.taskId)"
                  title="View Task">
                  <i class="bi bi-eye"></i> View Task
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mobile Cards -->
      <div class="d-md-none" *ngIf="!loading">
        <div class="row g-3">
          <div class="col-12" *ngFor="let req of paginatedRequests">
            <div
              class="card clickable-card border-0 shadow-sm p-3 h-100"
              (click)="navigateToTask(req.taskId)">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="fw-bold mb-1 text-primary">{{ req.taskTitle }}</h6>
                <span class="badge rounded-pill fw-bold" [ngClass]="getStatusClass(req.status)">
                  {{ req.status }}
                </span>
              </div>
              <p class="text-muted small mb-2">by <strong>{{ req.requestedByName }}</strong></p>
              <div class="d-flex align-items-center text-secondary small mb-2">
                <i [class]="getTypeBadge(req.requestType).icon" class="me-2"></i>
                <span>{{ getTypeBadge(req.requestType).text }}</span>
                <span class="mx-2">•</span>
                <span>{{ req.requestDate | date:'shortDate' }}</span>
              </div>
              <p class="text-muted small mb-0" *ngIf="req.remarks">
                <em>"{{ req.remarks }}"</em>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && filteredRequests.length === 0" class="text-center py-5">
        <i class="bi bi-inbox display-1 text-muted opacity-50"></i>
        <p class="mt-4 fs-4 text-muted">No requests found</p>
        <button class="btn btn-outline-primary" (click)="resetFilters()">Clear Filters</button>
      </div>

      <!-- Pagination -->
      <nav *ngIf="filteredRequests.length > 0" class="mt-5">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="changePage(currentPage - 1)" tabindex="-1">Previous</a>
          </li>
          <li class="page-item" *ngFor="let p of getPageNumbers()" [class.active]="currentPage === p">
            <a class="page-link" (click)="changePage(p)">{{ p }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="changePage(currentPage + 1)">Next</a>
          </li>
        </ul>
      </nav>

      <!-- Action Buttons -->
      <div class="text-center mt-4">
        <button class="btn btn-lg btn-outline-success me-3" (click)="refresh()">
          <i class="bi bi-arrow-repeat"></i> Refresh List
        </button>
        <button class="btn btn-lg btn-outline-primary" (click)="goBackToDashboard()">
          <i class="bi bi-arrow-left-circle"></i> Back to Dashboard
        </button>
      </div>

    </div>
  </div>
</div>