<div class="dashboard-wrapper">
  <!-- Modern Glass Sidebar -->
  <aside id="sidebarMenu" class="sidebar">
    <div class="sidebar-profile p-4 text-center">
      <div class="avatar-placeholder mb-3">
        <i class="bi bi-person-circle fs-1 text-black-50"></i>
      </div>
      <h6 class="mb-1 fw-bold text-black">Admin Dashboard</h6>
      <small class="text-black-50 d-block">{{ dashboardData?.email }}</small>
    </div>

    <ul class="nav flex-column px-3">
      <li class="nav-item mb-2" *ngFor="let link of sidebarLinks">
        <a class="nav-link d-flex align-items-center rounded-pill px-4 py-3 transition" [routerLink]="link.route"
          [queryParams]="link.queryParams" routerLinkActive="active">
          <i class="bi {{ link.icon }} me-3 fs-5"></i>
          <span class="fw-medium">{{ link.label }}</span>
        </a>
      </li>
    </ul>

    <div class="border-top mt-4 pt-4 px-4">
      <a class="nav-link text-white d-flex align-items-center fw-semibold px-4 py-3 rounded-pill hover-bg-danger-light"
        (click)="logout()">
        <i class="bi bi-box-arrow-right me-3 fs-5"></i>
        Logout
      </a>
    </div>
  </aside>

  <!-- Premium Main Content -->
  <main class="main-content">
    <ng-container *ngIf="dashboardData; else loading">
      <br><br>
      <!-- Premium Gradient Welcome Banner -->
      <div class="welcome-banner mb-5">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
          <div>
            <h2 class="display-5 fw-bold mb-2">Welcome Back, {{ dashboardData.userName }}!
              <!-- <span class="wave">ðŸ‘‹</span> -->
            </h2>
            <p class="lead mb-0 opacity-90">
              {{ currentDate | date: 'fullDate' }} â€¢ Here's what's happening in your system today.
            </p>
          </div>
          <div class="mt-4 mt-md-0">
            <span class="department-badge px-4 py-2 fs-6">Administrator</span>
          </div>
        </div>
      </div>
      <!-- Bulletin Alert -->
      <app-bulletin-banner class="mb-5"></app-bulletin-banner>
      <br><br>

      <!-- Stat Cards Grid -->
      <div class="row g-4 mb-5" @fadeInUpStagger>
        <div class="col-xl-3 col-lg-4 col-md-6" *ngFor="let card of statCards(dashboardData); let i = index">
          <div class="stat-card h-100 position-relative overflow-hidden rounded-4 shadow-sm"
            (click)="goToTaskPage(card)" style="cursor: pointer;">
            <div class="card-accent-bar"></div>
            <div class="card-glow-effect"></div>
            <div class="p-4 position-relative z-2">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                  <p class="text-muted small fw-semibold text-uppercase tracking-wider mb-1 opacity-80">
                    {{ card.title }}
                  </p>
                  <h3 class="fw-black mb-0 gradient-text-dark">{{ card.value || 0 }}</h3>
                </div>
                <div class="icon-circle bg-{{card.color}}-subtle text-{{card.color}}">
                  <i class="bi {{ card.icon }} fs-3"></i>
                </div>
              </div>
              <div class="d-flex align-items-center small">
                <span
                  [class]="'text-' + (card.delta > 0 ? 'success' : card.delta < 0 ? 'danger' : 'muted') + ' fw-semibold'">
                  <i class="bi me-1" [class.bi-arrow-up-right]="card.delta > 0"
                    [class.bi-arrow-down-right]="card.delta < 0" [class.bi-dash]="card.delta === 0"></i>
                  {{ card.delta > 0 ? '+' : '' }}{{ card.delta }}%
                </span>
                <span class="text-muted ms-2">vs last week</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section - New Pattern -->
      <div class="charts-container mb-5" @fadeInUpStagger>
        <!-- Two Charts Row -->
        <div class="row g-4 mb-4">
          <!-- Donut Chart -->
          <div class="col-lg-6">
            <div class="chart-card h-100 rounded-4 shadow-sm">
              <div class="card-header bg-gradient-primary text-white rounded-top-4">
                <h5 class="mb-0 fw-bold"><i class="bi bi-pie-chart-fill me-2"></i> Task Distribution</h5>
              </div>
              <div class="card-body p-4">
                <canvas baseChart [data]="pieChartData" [options]="pieChartOptions" type="pie" height="320"></canvas>
              </div>
            </div>
          </div>

          <!-- Bar Chart -->
          <div class="col-lg-6">
            <div class="chart-card h-100 rounded-4 shadow-sm">
              <div class="card-header bg-gradient-purple text-white rounded-top-4">
                <h5 class="mb-0 fw-bold"><i class="bi bi-bar-chart-fill me-2"></i> System Overview</h5>
              </div>
              <div class="card-body p-4">
                <canvas baseChart [data]="barChartData" [options]="barChartOptions" type="bar" height="320"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="chart-row mb-4">
          <div class="chart-card-large h-100 rounded-4 shadow-sm">
            <div class="card-header bg-gradient-success text-white rounded-top-4">
              <h5 class="mb-0 fw-bold"><i class="bi bi-graph-up-arrow me-2"></i> Activity Trends</h5>
            </div>
            <div class="card-body p-4">
              <canvas baseChart [data]="lineChartData" [options]="lineChartOptions" type="line" height="350"></canvas>
            </div>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-template #loading>
      <div class="d-flex flex-column align-items-center justify-content-center py-5 my-5">
        <div class="spinner-border text-primary mb-4" style="width: 4rem; height: 4rem;" role="status"></div>
        <h5 class="text-muted fw-medium">Loading your dashboard...</h5>
      </div>
    </ng-template>
  </main>
</div>