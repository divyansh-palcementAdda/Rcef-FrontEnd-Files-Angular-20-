<!-- Page Title with White Text to Avoid Navbar Overlap -->
<h1 class="text-center my-4 fw-bold" style="color: #fff;">All Users</h1>

<div class="container my-5">
  <div class="card shadow animate__animated animate__fadeIn">

    <!-- Header -->
    <div class="card-header py-3">
      <h3 class="mb-0 fw-bold">All Users</h3>
      <small class="text-light-50">View and manage all registered users</small>
    </div>

    <div class="card-body px-4 py-4">

      <!-- Alerts -->
      <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>Error!</strong> {{ errorMessage }}
        <button type="button" class="btn-close" (click)="errorMessage = null" aria-label="Close"></button>
      </div>

      <!-- Loading Spinner -->
      <div *ngIf="loading" class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <!-- Search & Filter -->
      <div class="row mb-3 g-2">
        <div class="col-md-6">
          <input type="text" class="form-control" placeholder="ðŸ” Search by name, email, or role"
            [(ngModel)]="searchTerm" (input)="applyFilters()">
        </div>
        <div class="col-md-3">
          <select class="form-select" [(ngModel)]="statusFilter" (change)="applyFilters()">
            <option value="">All Statuses</option>
            <option value="ACTIVE">Active</option>
            <option value="INACTIVE">Inactive</option>
          </select>
        </div>
        <div class="col-md-3">
          <button class="btn btn-outline-secondary w-100" (click)="resetFilters()">Reset Filters</button>
        </div>
      </div>

      <!-- Desktop Table -->
      <div class="table-responsive d-none d-md-block" *ngIf="!loading && paginatedUsers?.length">
        <table class="table table-borderless align-middle">
          <thead class="table_head">
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Status</th>
              <th>Department</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of paginatedUsers" (click)="goToUser(user.userId)">
              <td>{{ user.userId }}</td>
              <td>{{ user.fullName }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.role }}</td>
              <td>
                <span class="badge rounded-pill" [ngClass]="{
                        'bg-success blink': user.status === 'ACTIVE',
                        'bg-secondary': user.status === 'INACTIVE'
                      }">
                  {{ user.status }}
                </span>
              </td>
            <td>{{ user.role === 'ADMIN' ? 'Administration' : (user.departmentName || user.role) }}</td>
              <td class="text-center">
                <div class="row-actions">
                  <button class="btn btn-sm btn-outline-primary me-1"
                    (click)="viewUser($event, user.userId)">View</button>
                  <button class="btn btn-sm btn-outline-warning me-1"
                    (click)="editUser($event, user.userId)">Edit</button>
                  <button class="btn btn-sm btn-outline-danger"
                    (click)="deleteUser($event, user.userId)">Delete</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mobile Cards -->
      <div class="d-md-none" *ngIf="!loading && paginatedUsers?.length">
        <div class="row g-3">
          <div class="col-12" *ngFor="let user of paginatedUsers">
            <div class="clickable-card" (click)="goToUser(user.userId)">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="fw-bold mb-0">{{ user.fullName }}</h6>
                <span class="badge rounded-pill" [ngClass]="{
                        'bg-success blink': user.status === 'ACTIVE',
                        'bg-secondary': user.status === 'INACTIVE'
                      }">
                  {{ user.status }}
                </span>
              </div>
              <p class="mb-1"><strong>Email:</strong> {{ user.email }}</p>
              <p class="mb-1"><strong>Role:</strong> {{ user.role }}</p>
              <div class="d-flex justify-content-end gap-2 row-actions">
                <button class="btn btn-sm btn-outline-primary" (click)="viewUser($event, user.userId)">View</button>
                <button class="btn btn-sm btn-outline-warning" (click)="editUser($event, user.userId)">Edit</button>
                <button class="btn btn-sm btn-outline-danger" (click)="deleteUser($event, user.userId)">Delete</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- No Users Found -->
      <div *ngIf="!loading && !paginatedUsers?.length" class="text-center text-muted mt-4">
        No users found.
      </div>

      <!-- Pagination -->
      <nav *ngIf="filteredUsers?.length" aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="changePage(currentPage - 1)">Previous</a>
          </li>
          <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="currentPage === page">
            <a class="page-link" (click)="changePage(page)">{{ page }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="changePage(currentPage + 1)">Next</a>
          </li>
        </ul>
      </nav>

    </div>
  </div>
</div>