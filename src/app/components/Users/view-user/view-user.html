<br><br>
<div class="container py-5">

  <!-- âŒ Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger text-center shadow-sm rounded-pill py-3 fw-semibold">
    {{ errorMessage }}
  </div>

  <!-- â³ Loading User -->
  <div *ngIf="loadingUser" class="text-center my-5">
    <div class="spinner-border text-success"></div>
    <p class="mt-3 fw-medium text-muted">Loading user details...</p>
  </div>

  <!-- ğŸ‘¤ User Details Card -->
  <div *ngIf="user && !loadingUser" class="user-card shadow-lg border-0 rounded-4 overflow-hidden animate__animated animate__fadeInUp">
    <div class="user-header text-white text-center py-4">
      <h3 class="fw-bold mb-1">{{ user.fullName }}</h3>
      <p class="mb-0 text-light fs-6">{{ user.role }}</p>
    </div>

    <div class="card-body px-4 py-4">
      <div class="row gy-3">
        <div class="col-md-6">
          <p><i class="bi bi-person-circle me-2 text-primary"></i><strong>Username : </strong> {{ user.username }}</p>
          <p><i class="bi bi-envelope me-2 text-primary"></i><strong>Email : </strong> {{ user.email }}</p>
          <p><i class="bi bi-diagram-3 me-2 text-primary"></i><strong>Department : </strong> {{ user.departmentName || 'N/A' }}</p>
        </div>
        <div class="col-md-6">
          <p>
            <i class="bi bi-activity me-2 text-primary"></i><strong>Status : </strong>
            <span class="badge rounded-pill px-3 py-2 fs-6"
              [ngClass]="{
                'bg-success': user.status === 'ACTIVE',
                'bg-secondary': user.status === 'INACTIVE'
              }">{{ user.status }}</span>
          </p>

          <p>
            <i class="bi bi-shield-check me-2 text-primary"></i><strong>Email Verified : </strong>
            <span [ngClass]="user.emailVerified ? 'text-success fw-semibold' : 'text-danger fw-semibold'">
              {{ user.emailVerified ? 'Yes' : 'No' }}
            </span>
          </p>
        </div>
      </div>

      <!-- Task Summary Cards -->
      <div class="row text-center mt-4">
        <div class="col-6 col-md-3 mb-3" *ngFor="let stat of [
          {label: 'Pending', count: user.pendingTasks, color: 'warning'},
          {label: 'Upcoming', count: user.upcomingTasks, color: 'info'},
          {label: 'Delayed', count: user.delayedTasks, color: 'danger'},
          {label: 'Closed', count: user.closedTasks, color: 'success'}
        ]" (click)="filterByStatus(stat.label.toUpperCase())" style="cursor:pointer;">
          <div class="stat-card shadow-sm border-0 rounded-4 p-3 hover-zoom">
            <h4 class="fw-bold text-{{ stat.color }} mb-1">{{ stat.count || 0 }}</h4>
            <small class="text-muted">{{ stat.label }}</small>
          </div>
        </div>
      </div>

      <!-- Buttons -->
      <div class="text-center mt-4 d-flex justify-content-center flex-wrap gap-3">
        <button class="btn btn-outline-primary px-4 py-2" (click)="editUser()">
          <i class="bi bi-pencil-square me-2"></i>Edit User
        </button>

        <button *ngIf="user.status === 'ACTIVE'" class="btn btn-outline-danger px-4 py-2" (click)="deleteUser()">
          <i class="bi bi-person-x me-2"></i>Delete User
        </button>

        <button *ngIf="user.status === 'INACTIVE'" class="btn btn-success px-4 py-2 text-white" (click)="toggleUserStatus()">
          <i class="bi bi-person-check me-2"></i>Activate User
        </button>
      </div>
    </div>
  </div>

  <!-- ğŸ“‹ Task List -->
  <div *ngIf="userTasks?.length" class="card shadow-lg border-0 rounded-4 mt-5 animate__animated animate__fadeIn">
    <div class="card-header text-white text-center py-3 fs-5 task-header fw-semibold">
      Assigned Tasks
    </div>

    <div class="card-body p-4">

      <!-- Search + Reset -->
      <div class="row g-3 mb-3">
        <div class="col-md-6">
          <input type="text" class="form-control rounded-pill px-3" placeholder="ğŸ” Search tasks by title..."
                 [(ngModel)]="searchTerm" (input)="applyFilters()">
        </div>
        <div class="col-md-6 text-md-end">
          <button class="btn btn-outline-secondary rounded-pill px-4" (click)="resetFilters()">
            <i class="bi bi-arrow-clockwise me-1"></i>Reset Filters
          </button>
        </div>
      </div>

      <!-- Loading Tasks -->
      <div *ngIf="loadingTasks" class="text-center my-4">
        <div class="spinner-border text-success"></div>
        <p class="mt-2 text-muted">Fetching tasks...</p>
      </div>

      <!-- Tasks Table -->
      <div *ngIf="!loadingTasks && paginatedTasks?.length" class="table-responsive mt-3">
        <table class="table table-hover align-middle">
          <thead class="table_head">
            <tr>
              <th>ID</th>
              <th>Title</th>
              <th>Status</th>
              <th>Due Date</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let task of paginatedTasks" class="task-row">
              <td>{{ task.taskId }}</td>
              <td>{{ task.title }}</td>
              <td>
                <span class="badge rounded-pill px-3 py-2"
                  [ngClass]="{
                    'bg-warning text-dark': task.status === 'PENDING' || task.status === 'UPCOMING',
                    'bg-danger blink': task.status === 'DELAYED',
                    'bg-info text-dark': task.status === 'REQUEST_FOR_CLOSURE' || task.status === 'REQUEST_FOR_EXTENSION',
                    'bg-success': task.status === 'CLOSED'
                  }">{{ task.status }}</span>
              </td>
              <td>{{ task.dueDate | date: 'mediumDate' }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- No Tasks Found -->
      <div *ngIf="!loadingTasks && !paginatedTasks?.length" class="text-center text-muted mt-4">
        <i class="bi bi-clipboard-x fs-4"></i><br>No matching tasks found.
      </div>

      <!-- Pagination -->
      <nav *ngIf="(filteredTasks?.length || 0) > pageSize" class="mt-4">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" style="cursor:pointer;" (click)="changePage(currentPage - 1)">Previous</a>
          </li>
          <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="currentPage === page">
            <a class="page-link" style="cursor:pointer;" (click)="changePage(page)">{{ page }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" style="cursor:pointer;" (click)="changePage(currentPage + 1)">Next</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- âšª No Tasks At All -->
  <div *ngIf="!loadingTasks && !userTasks?.length" class="text-center text-muted mt-5">
    <i class="bi bi-clipboard-x fs-4"></i> No tasks assigned to this user.
  </div>
</div>
